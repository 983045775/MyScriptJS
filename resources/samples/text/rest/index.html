<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Text - REST sample</title>
</head>

<body>
<h1>Text - REST sample</h1>
<button id="trash">Trash</button>
<button id="undo">Undo</button>
<button id="redo">Redo</button>
<label for="languages">Language: </label>
<select id="languages">
    <option value="en_US">en_US</option>
    <option value="fr_FR">fr_FR</option>
    <option value="es_MX">es_MX</option>
</select>
<br/>
<div id="mycanvas" style="background-color: lightyellow; border: 1px solid darkgoldenrod; width: 400px; height: 300px"></div>
<br/>
<pre id="result" style="font-size: 40px;"></pre>
</body>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/core-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/x64-core-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha512-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/hmac-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.2.1/q.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handjs/1.3.11/hand.min.js"></script>
<script type="text/javascript" src="../../lib/myscript.js"></script>
<script>
    function initialize() {
        var drawCanvas = document.getElementById('mycanvas');
        var drawOptions = {
            applicationKey: "a8f991e2-994d-4f36-b61d-55f7ddf6f85d",
            hmacKey:  "7b2cbc25-321e-4699-a1f3-b6d7e64eea63",
            type: "Text"
        }

        var draw = new MyScript.InkPaper(drawCanvas, drawOptions);
    }
    MyScript.InkPaper.event.addDomListener(window, 'load', initialize);

//    (function () {
//        var result = document.getElementById('result');
//
//        var canvas = document.createElement('canvas');
//        var div = document.getElementById('mycanvas');
//        canvas.id = 'current';
//        canvas.style.width = div.style.width;
//        canvas.style.height = div.style.height;
//        canvas.style.zIndex = '2';
//        canvas.style.position = 'absolute';
//        canvas.width = div.clientWidth;
//        canvas.height = div.clientHeight;
//        canvas.oncontextmenu = function (e) {
//            e.preventDefault();
//        };
//
//        var trash = document.getElementById('trash');
//        var undo = document.getElementById('undo');
//        var redo = document.getElementById('redo');
//        var languages = document.getElementById('languages');
//        var pointerId;
//
//        var applicationKey = "a8f991e2-994d-4f36-b61d-55f7ddf6f85d";
//        var hmacKey = "7b2cbc25-321e-4699-a1f3-b6d7e64eea63";
//
//        var inkManager = new MyScript.InkManager();
//        var textRenderer = new MyScript.TextRenderer();
//        var textRecognizer = new MyScript.TextRecognizer();
//        var instanceId;
//
//        function doRecognition() {
//
//            if (inkManager.isEmpty()) {
//                result.innerHTML = '';
//            } else {
//
//                var inputUnit = new MyScript.TextInputUnit();
//                inputUnit.setComponents(inkManager.getStrokes());
//
//                var units = [inputUnit];
//
//                textRecognizer.doSimpleRecognition(applicationKey, instanceId, units, hmacKey).then(
//                        function (data) {
//                            if (!instanceId) {
//                                instanceId = data.getInstanceId();
//                            } else if (instanceId !== data.getInstanceId()) {
//                                return;
//                            }
//
//                            result.innerHTML = data.getTextDocument().getTextSegment().getSelectedCandidate().getLabel();
//                        }
//                );
//            }
//        }
//
//        canvas.addEventListener('pointerdown', function (event) {
//            if (!pointerId) {
//                pointerId = event.pointerId;
//                event.preventDefault();
//
//                textRenderer.drawStart(event.offsetX, event.offsetY, event.timeStamp, getCurrentStrokeContext());
//                inkManager.startInkCapture(event.offsetX, event.offsetY, event.timeStamp);
//            }
//        }, false);
//
//        canvas.addEventListener('pointermove', function (event) {
//            if (pointerId === event.pointerId) {
//                event.preventDefault();
//
//                textRenderer.drawContinue(event.offsetX, event.offsetY, event.timeStamp, getCurrentStrokeContext());
//                inkManager.continueInkCapture(event.offsetX, event.offsetY, event.timeStamp);
//            }
//        }, false);
//
//        canvas.addEventListener('pointerup', function (event) {
//            if (pointerId === event.pointerId) {
//                event.preventDefault();
//
//                textRenderer.drawEnd(event.offsetX, event.offsetY, event.timeStamp, getCurrentStrokeContext(), getFinalStrokesContext());
//                inkManager.endInkCapture(event.offsetX, event.offsetY, event.timeStamp);
//                pointerId = undefined;
//                doRecognition();
//            }
//        }, false);
//
//        canvas.addEventListener('pointerleave', function (event) {
//            if (pointerId === event.pointerId) {
//                event.preventDefault();
//
//                textRenderer.drawEnd(event.offsetX, event.offsetY, event.timeStamp, getCurrentStrokeContext(), getFinalStrokesContext());
//                inkManager.endInkCapture(event.offsetX, event.offsetY, event.timeStamp);
//                pointerId = undefined;
//                doRecognition();
//            }
//        }, false);
//
//        div.appendChild(canvas);
//
//        canvas = document.createElement('canvas');
//        canvas.id = 'final';
//        canvas.style.width = div.style.width;
//        canvas.style.height = div.style.height;
//        canvas.style.zIndex = '1';
//        canvas.style.position = 'absolute';
//        canvas.width = div.clientWidth;
//        canvas.height = div.clientHeight;
//        div.appendChild(canvas);
//
//        trash.addEventListener('click', function () {
//            instanceId = undefined;
//            textRenderer.clear(getCurrentStrokeContext(), getFinalStrokesContext());
//            inkManager.clear();
//            result.innerHTML = '';
//        }, false);
//
//        undo.addEventListener('click', function () {
//            if (!inkManager.isEmpty()) {
//                inkManager.undo();
//                textRenderer.clear(getCurrentStrokeContext(), getFinalStrokesContext());
//                textRenderer.drawStrokes(inkManager.getStrokes(), getCurrentStrokeContext(), getFinalStrokesContext());
//            }
//            doRecognition();
//        }, false);
//
//        redo.addEventListener('click', function () {
//            if (!inkManager.isRedoEmpty()) {
//                inkManager.redo();
//                textRenderer.clear(getCurrentStrokeContext(), getFinalStrokesContext());
//                textRenderer.drawStrokes(inkManager.getStrokes(), getCurrentStrokeContext(), getFinalStrokesContext());
//            }
//            doRecognition();
//        }, false);
//
//        languages.addEventListener('change', function () {
//            textRecognizer.getParameters().setLanguage(languages.options[languages.selectedIndex].value);
//            doRecognition();
//        }, false);
//
//        function getContext(canvasid) {
//            return document.getElementById(canvasid).getContext('2d');
//        };
//
//        function getCurrentStrokeContext() {
//            return getContext('current');
//        };
//
//        function getFinalStrokesContext() {
//            return getContext('final');
//        };
//
//    })();
</script>
</html>
