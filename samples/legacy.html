<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>MyScriptJS demo</title>

    <!-- Live reload with webpack -->
    <script src="http://localhost:8080/webpack-dev-server.js"></script>

    <!-- PEP import -->
    <script type="text/javascript" src="/node_modules/pepjs/dist/pep.min.js"></script>
    <!-- MyScriptJS import -->
    <link rel="stylesheet" href="/dist/myscript.min.css"/>
    <!-- Do not remove the dev prefix if you want dev hot reload -->
    <script src="/dev/dist/myscript.min.js"></script>
</head>
<body touch-action="none">
<h1>MyScriptJS demo</h1>
<button id="trash">Trash</button>
<button id="undo">Undo</button>
<button id="redo">Redo</button>
<label for="languages">Language: </label>
<select id="languages" disabled></select>
<br/>
<div id="ink-paper"></div>
<br/>
<pre id="result" style="font-size: 40px"></pre>
</body>
<script>
    (function () {
        function initialize() {
            var result = document.getElementById('result');
            var inkPaper = document.getElementById('ink-paper');

            var trash = document.getElementById('trash');
            var undo = document.getElementById('undo');
            var redo = document.getElementById('redo');
            var languages = document.getElementById('languages');

            var options = {
                host: "webdemoapi.myscript.com", // Handle MyScript Cloud authentication keys (cloud.myscript.com)
                applicationKey: "22eda92c-10af-40d8-abea-fd4093c17d81", // MyScript Cloud application key - change the keys for production use
                hmacKey: "a1fa759f-b3ce-4091-9fd4-d34bb870c601", // MyScript Cloud HMAC key - change the keys for production use
                type: MyScript.MyScriptJSConstants.RecognitionType.TEXT, // Recognition type
                protocol: MyScript.MyScriptJSConstants.Protocol.REST,
                width: 800, // InkPaper width
                height: 600, // InkPaper height
                timeout: 25, // Recognition timeout
                textParameters: {
                    language: 'en_US' // Set the recognition language (i.e.: 'en_US', 'fr_FR', ...)
                }
            };
            /**
             * As canvas are positioned absolute to overlay, we have to explicitly set the parent dimensions
             */
            inkPaper.style.height = options.height + 'px';
            inkPaper.style.width = options.width + 'px';
            /**
             * Init the ink paper
             * @param {Element} The DOM element to attach the ink paper
             * @param {Object} The recognition options
             * @param {Function} The result callback
             */
            var paper = new MyScript.InkPaper(inkPaper, options);
            paper.setResultCallback(function (res, err) {
                // Handle recognition result
                result.innerHTML = '';
                if (err) {
                    result.innerHTML = err;
                }
                if (res && res.result) {
                    const textSegment = res.result.textSegmentResult;
                    result.innerHTML = textSegment.candidates[textSegment.selectedCandidateIdx].label;
                }
            });
            paper.setChangeCallback(function (res) {
                if (res) {
                    trash.disabled = !(res.canClear);
                    undo.disabled = !(res.canUndo);
                    redo.disabled = !(res.canRedo);
                }
            });
            /**
             * Map the buttons
             */
            trash.addEventListener('click', function () {
                paper.clear();
            }, false);
            undo.addEventListener('click', function () {
                paper.undo();
            }, false);
            redo.addEventListener('click', function () {
                paper.redo();
            }, false);
//            languages.addEventListener('change', function () {
//                var parameters = paper.getTextParameters();
//                parameters.setLanguage(languages.options[languages.selectedIndex].value);
//                paper.setTextParameters(parameters);
//            }, false);
//            paper.getAvailableLanguages();
        }
        window.addEventListener('load', initialize);
    })();
</script>
</html>
