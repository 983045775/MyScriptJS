<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>MyScript JS</title>
<link rel="stylesheet" href="../../css/MySBuilder.css" type="text/css">
<link rel="shortcut icon" href="../../images/favicon.ico" />

<script type="text/javascript" src="../../js/prism.js" > </script> 
</head>

<body bgcolor="#FFFFFF" text="#000000">

<h1>MyScript JS Developer Guide</h1>
<p><img src="../../images/ic-text.png" style="float:right" width="80" height="80"></p>

<h2>Text recognition</h2>
<p>MyScript Cloud can recognize handwritten text and transform it into digital text.</p>
<p style="text-align:center"><img src="../../images/text_reco.png"></p>
<p>For more information on how MyScript recognizes handwriting, <a href="../appendices/reco_overview.html" target="main">see the appendix</a>. </p>
<h3>Making a text recognition request</h3>
<p>The below example shows a text recognition request where the following  are to be specified:</li>
<ul><ul>
<li>URL (defined by default)</li>
<li>application key &amp; HMAC key (obtained in the <a href="http://cloud.myscript.com" target="_blank">MyScript Cloud Admin UI</a>)</li>
<li>language (US English by default)</li>
</ul>
</ul>

<pre class="language-javascript"><code><p>&lt;script&gt;
    var result = document.getElementById("text-result");
    var canvas = document.getElementById("text-canvas");
    var context = canvas.getContext("2d");
    var pointerId;

    var url = 'http://cloud.myscript.com/api/v3.0/recognition/rest';
    var applicationKey = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
    var hmacKey = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
    var textRecognizer = new MyScript.TextRecognizer(url);
    textRecognizer.getParameters().setLanguage('xx_XX');
    var instanceId;

  function doRecognition () {

      var inputUnit = new MyScript.TextInputUnit();
      inputUnit.setComponents(stroker.getStrokes());

      var units = [inputUnit];

      textRecognizer.doSimpleRecognition(applicationKey, instanceId, units, hmacKey).then(
              function (data) {
                  if (!instanceId) {
                      instanceId = data.getInstanceId();
                  } else if (instanceId !== data.getInstanceId()) {
                      return;
                  }

                  result.innerText = JSON.stringify(data.getTextDocument());
              }
      )
  }

  var stroker = new MyScript.Stroker();
  var renderingParameters = new MyScript.RenderingParameters();
  var textRenderer = new MyScript.TextRenderer();

  function onPointerDown (event, x, y) {
      textRenderer.drawStart(event, x, y);
      stroker.startStrokeWriting(x, y);
  }

  function onPointerMove (event, x, y) {
      textRenderer.drawContinue(event, x, y, renderingParameters, context);
      stroker.continueStrokeWriting(x, y);
  }

  function onPointerUp (event, x, y) {
      textRenderer.drawEnd(event, x, y, renderingParameters, context);
      stroker.endStrokeWriting(event);
      if (!stroker.isEmpty()) {
          doRecognition();
      }
  }

  /**
   * Firefox missing offsetX and offsetY properties hack
   * @param event
   * @returns {{x: number, y: number}}
   */</p><p>
    function getOffset (event) {

        var element = event.target;
        var offset = {x: 0, y: 0};

        while (element.offsetParent) {
            offset.x += element.offsetLeft;
            offset.y += element.offsetTop;
            element = element.offsetParent;
        }

        offset.x = event.pageX - offset.x;
        offset.y = event.pageY - offset.y;

        return offset;
    }

    function getX (event) {
        if (event.offsetX) {
            return event.offsetX;
        }
        return getOffset(event).x;
    }

    function getY (event) {
        if (event.offsetY) {
            return event.offsetY;
        }
        return getOffset(event).y;
    }

    canvas.addEventListener('mousedown', function (event) {
        if (!pointerId) {
            pointerId = event.pointerId;
            onPointerDown(event, getX(event), getY(event));
        }
    }, false);

    canvas.addEventListener('mousemove', function (event) {
        if (pointerId === event.pointerId) {
            onPointerMove(event, getX(event), getY(event));
        }
    }, false);

    canvas.addEventListener('mouseup', function (event) {
        if (pointerId === event.pointerId) {
            onPointerUp(event, getX(event), getY(event));
            pointerId = undefined;
        }
    }, false);

    canvas.addEventListener('mouseleave', function (event) {
        if (pointerId === event.pointerId) {
            onPointerUp(event, getX(event), getY(event));
            pointerId = undefined;
        }
    }, false);
&lt;/script&gt;</p></code></pre>
<p>&nbsp;</p>
</body>
</html>
