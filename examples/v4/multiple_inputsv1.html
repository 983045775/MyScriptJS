<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="HandheldFriendly" content="true"/>

  <title>Multiple inputs</title>

  <link rel="stylesheet" href="../../dist/myscript.min.css"/>
  <link rel="stylesheet" href="../examples.css">

  <style>
    #editor {
      border-radius: 6px;
    }

    main {
      display: flex;
      flex-direction: column;
      padding: 24px;
    }

    .input {
      font-size: 36px;
      padding: 24px 36px;
      margin-bottom: 24px;
      width: 80%;
      height: 300px;
      border: 1px #bfbfbf solid;
      border-radius: 6px;
    }
  </style>

  <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
  <script type="text/javascript" src="../../dist/myscript.min.js"></script>
</head>

<body>
<div>
  <nav>
    <div class="button-div">
      <button id="undo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
        <img src="../assets/img/undo.svg">
      </button>
      <button id="redo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
        <img src="../assets/img/redo.svg">
      </button>
    </div>
  </nav>
  <main>
    <label for="input1">
      Your 1st input
    </label>
    <div class="input" id="input1"></div>
    <label for="input2">
      Your 2nd input
    </label>
    <div class="input" id="input2"></div>
    <label for="input3">
      Your 3rd input
    </label>
    <div class="input" id="input3"></div>
    <label for="input4">
      Your 4th input
    </label>
    <div class="input" id="input4"></div>
  </main>
  <div id="editor" touch-action="none"></div>
  <div id="editor2" touch-action="none"></div>
</div>
<script>
  let selectedInput;
  let selectedEditor = 0;
  let editorElementRef;
  let currentExport = "";

  const editorElement = document.getElementById('editor');
  const editorElement2 = document.getElementById('editor2');

  const undoElement = document.getElementById('undo');
  const redoElement = document.getElementById('redo');

  const input1 = document.getElementById('input1');
  const input2 = document.getElementById('input2');
  const input3 = document.getElementById('input3');
  const input4 = document.getElementById('input4');

  const inputValues = new Map();
  inputValues.set(input1.id, '');
  inputValues.set(input2.id, '');
  inputValues.set(input3.id, '');
  inputValues.set(input4.id, '');

  for (const input of inputValues.keys()) {
    initInputListener(input);
  }

  function initInputListener(inputId) {
    const input = document.getElementById(inputId);
    input.addEventListener('click', function (event) {
      if (selectedInput !== input) {
        if (selectedInput)
          selectedInput.innerText = currentExport;

        if (editorElementRef) {
          editorElementRef.style.display = 'none';
          editorElementRef.editor.clear();
        }
        selectedEditor === 0 ? editorElementRef = editorElement : editorElementRef = editorElement2;
        console.log(editorElementRef);
        selectedInput = input;
        editorElementRef.style.width = `${event.target.clientWidth}px`;
        editorElementRef.style.height = `${event.target.clientHeight}px`;
        editorElementRef.style.display = 'block';
        editorElementRef.style.position = 'absolute';
        editorElementRef.style.left = `${event.target.offsetLeft + 1}px`;
        editorElementRef.style.top = `${event.target.offsetTop + 1}px`;
        editorElementRef.style.background = 'white';
        const inputValue = selectedInput.innerText;
        if (inputValue) {
          editorElementRef.editor.import_(inputValue, 'text/plain');
        }
        editorElementRef.editor.resize();
        selectedEditor === 0 ? selectedEditor = 1 : selectedEditor = 0;
      }
    });
  }

  editorElement.addEventListener('changed', function (event) {
    undoElement.disabled = !event.detail.canUndo;
    redoElement.disabled = !event.detail.canRedo;
  });

  editorElement.addEventListener('exported', function (evt) {
    const exports = evt.detail.exports;
    if (exports && exports['text/plain'] !== undefined) {
      currentExport = exports['text/plain'];
      // selectedInput.innerText = exports['text/plain'];
      // inputValues.set(selectedInput.id, exports['text/plain']);
    } else {
      currentExport = "";
      // selectedInput.innerText = "";
      // inputValues.set(selectedInput.id, "");
    }
  });

  editorElement2.addEventListener('exported', function (evt) {
    const exports = evt.detail.exports;
    if (exports && exports['text/plain'] !== undefined) {
      currentExport = exports['text/plain'];
      // selectedInput.innerText = exports['text/plain'];
      // inputValues.set(selectedInput.id, exports['text/plain']);
    } else {
      currentExport = "";
      // selectedInput.innerText = "";
      // inputValues.set(selectedInput.id, "");
    }
  });

  undoElement.addEventListener('click', function () {
    editorElement.editor.undo();
  });
  redoElement.addEventListener('click', function () {
    editorElement.editor.redo();
  });

  editorElement.addEventListener('loaded', function() {
    editorElement.style.display = 'none';
    editorElement2.style.display = 'none';
  });

  function initEditors(editors) {
    editors.forEach(function(editorElement) {
      MyScript.register(editorElement, {
        recognitionParams: {
          type: 'TEXT',
          protocol: 'WEBSOCKET',
          apiVersion: 'V4',
          server: {
            scheme: 'https',
            host: 'cloud-internal-stable.corp.myscript.com',
            applicationKey: '515131ab-35fa-411c-bb4d-3917e00faf60',
            hmacKey: '54b2ca8a-6752-469d-87dd-553bb450e9ad'
          },
          v4: {
            text: {
              smartGuide: false,
              margin: {
                left: 10,
                right: 10,
                top: 5
              }
            }
          }
        }
      });
    });
  }

  initEditors([editorElement, editorElement2]);

  window.addEventListener('resize', function () {
    editorElement.editor.resize();
    editorElement2.editor.resize();
  });
</script>
</body>

</html>